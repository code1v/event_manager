<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🎉 Student Events</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to right, #ff9a9e, #fad0c4);
      min-height: 100vh;
    }
    .event-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .event-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .countdown {
      font-size: 0.9rem;
      font-weight: bold;
      color: #333;
    }
    .registrations {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 8px;
      margin-top: 10px;
    }
    .registrations h6 {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">🎉 Student Events</a>
      <a href="/add" class="btn btn-success">➕ Add Event</a>
    </div>
  </nav>

  <div class="container py-5">
    <h1 class="text-center mb-4">Upcoming Events</h1>

    <!-- Search & Filter -->
    <div class="d-flex justify-content-between mb-4">
      <input type="text" id="searchBar" class="form-control w-50" placeholder="🔍 Search events...">
      <select id="filterCategory" class="form-select w-25 ms-3">
        <option value="">All Categories</option>
        <option value="Tech">Tech</option>
        <option value="Cultural">Cultural</option>
        <option value="Sports">Sports</option>
        <option value="Workshop">Workshop</option>
      </select>
    </div>

    <!-- Event Cards -->
    <div class="row" id="eventGrid">
      {% for event in events %}
      <div class="col-md-4 mb-4 event-item" 
           data-title="{{event.title}}" 
           data-category="{{event.category}}" 
           data-date="{{event.date}}">
        <div class="card event-card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ event.title }}</h5>
            <p><strong>Date:</strong> {{ event.date }}</p>
            <p><strong>Location:</strong> {{ event.location }}</p>
            <p><span class="badge bg-info">{{ event.category }}</span></p>
            <p class="countdown" id="countdown-{{event.id}}" data-date="{{event.date}}">Loading...</p>
            <a href="/register/{{event.id}}" class="btn btn-primary">Register 🎟️</a>

            <!-- Registrations Section -->
            <div class="registrations">
              <h6>👥 Registrations ({{ registrations[event.id]|length }})</h6>
              {% if registrations[event.id] %}
                <ul class="list-unstyled mb-0">
                  {% for student in registrations[event.id] %}
                    <li>✅ {{ student }}</li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted">No registrations yet.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Live Search + Filter
    const searchBar = document.getElementById("searchBar");
    const filterCategory = document.getElementById("filterCategory");
    const items = document.querySelectorAll(".event-item");

    function filterEvents() {
      let searchText = searchBar.value.toLowerCase();
      let category = filterCategory.value;

      items.forEach(item => {
        let title = item.dataset.title.toLowerCase();
        let cat = item.dataset.category;
        let matchesSearch = title.includes(searchText);
        let matchesCategory = category === "" || category === cat;

        item.style.display = matchesSearch && matchesCategory ? "block" : "none";
      });
    }

    searchBar.addEventListener("keyup", filterEvents);
    filterCategory.addEventListener("change", filterEvents);

    // Countdown Timer
    function startCountdown() {
      const countdowns = document.querySelectorAll(".countdown");
      countdowns.forEach(cd => {
        const eventDate = new Date(cd.dataset.date).getTime();
        const timer = setInterval(() => {
          const now = new Date().getTime();
          const diff = eventDate - now;

          if (diff <= 0) {
            cd.innerHTML = "🚀 Happening Now!";
            clearInterval(timer);
            return;
          }

          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

          cd.innerHTML = `⏳ ${days}d ${hours}h ${minutes}m left`;
        }, 1000);
      });
    }
    startCountdown();
  </script>
</body>
</html>
